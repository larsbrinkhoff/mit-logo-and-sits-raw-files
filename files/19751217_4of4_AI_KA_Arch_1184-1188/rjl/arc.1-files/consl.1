A=%0
B=%1
C=%2
D=%4
E=%5
P=%6
PC=%7

PS=-2

TPBRV=64
TPS=177564
TPB=177566

TKBRV=60
TKS=177560
TKB=177562

DCRBRV=300
DCRS=174000
DCRB=174002

DCTBRV=304
DCTS=174004
DCTB=174006

.=0
.REPT 200
	.+2
	HALT
.ENDR

.IRP VEC,<TK,TP,DCR,DCT>
	.=VEC'BRV+2
	340		;SET ALL TO LEVEL 7
.ENDM

.=400
	.BLKW 40
PDL:
BUFL==100.
BUFF:	.BLKB BUFL
BUFFE::
IPNT:	BUFF
OPNT:	BUFF
BCNT:	BUFL


.=1000

GO:	RESET
	MOV #PDL,P
	MOV #BUFL,BCNT
	MOV #BUFF,IPNT
	MOV #BUFF,OPNT
	MOV #ITYI,TKBRV
	MOV #ITYO,TPBRV
	MOV #ITTYI,DCRBRV
	MOV #ITTYO,DCTBRV
	MOV #100,TKS
	MOV #100,TPS
	MOV #131,DCRS
	MOV #131,DCTS
	WAIT
	BR .-2

;PUT CHAR IN OUTPUT BUFF IF THERE IS ROOM, OTHERWISE IGNORE
TYO:	TST BCNT
	BNE .+4
	RTS PC
	MOV PS,-(P)
	SPL 7
	MOVB C,@IPNT
	INC IPNT
	DEC BCNT
	CMP IPNT,#BUFFE
	BNE .+10
	MOV #BUFF,IPNT
	BIC #100,TPS
	BIS #100,TPS
	MOV (P)+,PS
	RTS PC

ITYO:	CMP #BUFL,BCNT
	BNE .+4
	RTT
	INC BCNT
	MOVB @OPNT,TPB
	INC OPNT
	CMP #BUFFE,OPNT
	BEQ .+4
	RTT
	MOV #BUFF,OPNT
	RTT

ITTYI:	MOV C,-(P)
	MOV DCRB,C
	JSR PC,TYO
	MOV (P)+,C
	RTT

ITYI:	MOVB TKB,DCTB
	RTT

ITTYO:	RTT

.END GO
