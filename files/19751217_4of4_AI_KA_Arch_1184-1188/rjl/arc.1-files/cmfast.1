A=%0
B=%1
C=%2
D=%4
E=%5
P=%6
PC=%7


RKCS=177404

RFCS=177460

DHSCR=160020
DHLPR=160024
DHCAR=160026
DHWC=160030
DHBAR=160032

.=0
.REPT 200
	.+2
	HALT
.ENDR

.=200
JMP GO

.=600
PDL:
DHCNT:	0
RKCNT:	0
RFCNT:	0
LPCNT:	0

LOOP=40000
BUFF=60000

RKCMD:	-10000
	BUFF
	34400

RFCMD:	-10000
	BUFF
	0
	2

MOVE:	MOV A,A

GO:	RESET
	MOV #PDL,P
	MOV #LOOP,A
	MOV #10000,B
LPLOOP:	MOV MOVE,(A)+
	SOB B,.-4
	MOV #137,BUFF-4
	MOV #DEVLP,BUFF-2
	CLR RKCNT
	CLR RFCNT
	CLR DHCNT
	CLR LPCNT
DEVLP:	BIT #1,177570	;FIXED HEAD DISK?
	BEQ DEVLP1
	TST RFCS
	BPL .+4
	HALT
	TSTB RFCS
	BGE DEVLP1
	INC RFCNT
	MOV #RFCMD,A
	MOV #RFCS+2,B
	MOV (A)+,(B)+
	MOV (A)+,(B)+
	MOV (A)+,(B)+
	MOV (A)+,(B)+
	MOV #3,RFCS
DEVLP1:	BIT #2,177570
	BEQ DEVLP2
	TST RKCS
	BGE .+4
	HALT
	TSTB RKCS
	BGE DEVLP2
	INC RKCNT
	MOV #RKCMD,A
	MOV #RKCS+2,B
	MOV (A)+,(B)+
	MOV (A)+,(B)+
	MOV (A),(B)
	MOV #3,RKCS
DEVLP2:	BIT #4,177570
	BEQ DEVLP3
	BIT #2000,DHSCR
	BEQ .+4
	HALT
	TST DHBAR
	BNE DEVLP3
	INC DHCNT
	CLR DHSCR
	MOV #20,A
DHLP:	MOV #32000,DHSCR
	MOV #BUFF,DHCAR
	MOV #-10000,DHWC
	INC DHSCR
	BIC #20,DHSCR
	SOB A,DHLP
	MOV #-1,DHBAR
DEVLP3:	INC LPCNT
	JMP LOOP

.END GO
