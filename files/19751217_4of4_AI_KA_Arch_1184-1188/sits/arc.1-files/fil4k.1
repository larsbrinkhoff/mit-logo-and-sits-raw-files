A=%0
B=%1
C=%2
D=%3
E=%4
F=%5
P=%6
PC=%7
.INSRT SITS;SITSS SYMS
.MACRO SYSCAL AFOO,BFOO,CFOO,DFOO
	MOV CFOO,-(P)
	MOV BFOO,-(P)
	MOV AFOO,-(P)
.IFNB DFOO
	BIS DFOO,(P)
.ENDC
	.INVOK
	BNE .+4
	BPT
.ENDM

.=400
GO:	MOV #PDL,P
	SYSCAL ROOTCP,#0,#-1,#.CPYCP	;COPY ROOT CAP
	MOV (P)+,BEECP			;GOT BEE CAP
	SYSCAL BEECP,#MUTBLK,#0,#.FAMU	;MUTATE TO BEE'S DIR
ADLOOP:	SYSCAL BEECP,#FILBLK,#0,#.FAAD	;INSERT A DIR IN DIR
	SYSCAL BEECP,#0,#-1,#.CPYCP
	MOV (P)+,FILCAP
	SYSCAL FILCAP,#FILBLK,#0,#.FAMU	;MUTATE TO THE FILE
	MOV #0,-(P)
	MOV #-20000,-(P)
	MOV FILCAP,-(P)
	.BLKO
	MOV #0,-(P)
	MOV #0,-(P)
	MOV FILCAP,-(P)
	MOVB #1,1(P)
	MOV #.CRWRT+1,-(P)
	.MAP+200
	MOV #4,A
BLKOL:	MOV #0,-(P)
	MOV #-20000,-(P)
	MOV FILCAP,-(P)
	.BLKO
	SOB A,BLKOL
	SYSCAL BEECP,#0,#0,#.DELCP	;NOW DELETE BEE DIR CAP
	SYSCAL FILCAP,#0,#0,#.DELCP	;SEE IF WE WIN HERE
	CMP -(P),-(P)
	MOV #-3,-(P)
	MOVB #1,1(P)
	MOV #1,-(P)
	.MAP+200
	BPT
.BLKW 40
PDL::
MUTBLK:	.ASCIZ /./
	.EVEN
FILBLK:	.ASCIZ /FRED #259/
	.EVEN
FILBK1:	.ASCIZ /. FRED  >/
	.EVEN
FILBK2:	.ASCIZ /FRED >/
	.EVEN
BLKLEN:	512.
ROOTCP:	10		;ROOT DIRECTORY CAP IS HERE
BEECP:	0		;BEE DIRECTORY CAP IS HERE
FILCAP:	0		;CAP TO VERSION #77 IS HERE
.END GO
