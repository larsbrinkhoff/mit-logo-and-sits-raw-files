

TO CHORUS :X
10 LOCAL "MAX" "BUF" "Y"
15 MAKE "Y" 1
20 MAKE "MAX" MBUFCOUNT
30 MAKE "BUF" :MAX-1
40 IF EMPTYP :X GO 200
45 IF :X="VOICES" PLAY THING "V"&:Y MAKE "Y" :Y+1 GO 70
50 DO FIRST :X
60 MAKE "X" BUTFIRST :X
70 MAKE "MAX" MAXIMUM :MAX MBUFCOUNT
90 MBUFSTART
100 MAKE "BUF" :BUF+1
110 MBUFNEXT :BUF
120 GO 40
200 MBUFSTART
210 MBUFNEXT ((:MAX-1)/4)*4
END

TO STARTMUSIC
1 PRINT "YOU ARE NOW USING THE NEW MINI-MUSIC SYSTEM"
5 CONTROLLER
10 MBUFINIT
20 NVOICES 4
30 MBUFCLEAR
40 MAKE "TUNEBASE" 23
50 MAKE "SCALEBASE" 0
60 MAKE "INSTRUMENT" "LEGATO"
70 MAKE "FLATS" ""
80 MAKE "SHARPS" ""
90 MAKE "LASTPITCH" 23
100 MAKE "LASTDURATION" 2
110 MAKE "SCALE" "0 2 4 5 7 9 11"
120 MAKE "PIANOC" 23
END

TO NVOICES :N
10 MAKE "NVOICES" :N
20 VOICES :N
END

TO VOICE :N
10 MBUFSTART
20 MBUFNEXT :N-1
END

TO PERFORM
10 MBUFOUT
20 MBUFCLEAR
END

TO REST
10 OUTPUT -25
END

TO BOOM
10 OUTPUT -24
END

TO GRITCH
10 OUTPUT -23
END

TO PRESAVE
10 PRESUB
20 ERASE PRESUB
END

TO PRESUB
10 ERASE CHORUS
20 ERASE STARTMUSIC
30 ERASE NVOICES
40 ERASE VOICE
50 ERASE PERFORM
60 ERASE REST
70 ERASE BOOM
80 ERASE GRITCH
END
MAKENVOICES 4
MAKETUNEBASE 23
MAKESCALEBASE 0
MAKEINSTRUMENT LEGATO
MAKEFLATS 
MAKESHARPS 
MAKELASTPITCH 23
MAKELASTDURATION 2
MAKESCALE 0 2 4 5 7 9 11
MAKEPIANOC 23

